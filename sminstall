#!/bin/sh
#
prog=sminstall
usage=$prog
#
#	Install the slowmovie software on Raspberry Pi running Debian,
#	FreeBSD machines, and MacOS.

BIN=$HOME/bin

if [ ! -d $BIN ]
then
	mkdir -p ${BIN}	|| exit 1
fi

for p in ffmpeg xloadimage w9wm xterm
do
	if [ ! -n `which $p` ]
	then
		case `uname` in
		Linux)
			sudo apt-get install -y $p	|| exit 10
			;;
		FreeBSD)
			sudo sudo pkg -y install $p
			;;
		Darwin)
			# stub
			;;
		esac
	fi
done

progs="addsm updatesm playsm playallsm indexsm slowdefs"

for i in $progs
do
	if [ ! -s $BIN/$i -o $i -nt $BIN/$i ]
	then
		cp $i $BIN/$i	|| exit 2
	fi
done


# Set up .xinitrc to start up things

cat <<!EOF >$HOME/.xinitrc
#!/bin/sh

xsetroot -solid darkblue -cursor_name top_left_arrow
xset s off

sleep 2; playallsm &

exec w9wm -term xterm
!EOF


# add x start to .profile

if ! grep startx $HOME/.profile >/dev/null
then
	cat <<!EOF >>$HOME/.profile

export  PATH=$PATH:$HOME/bin

case `tty` in
/dev/tty1)      startx -- -nocursor;;
esac
!EOF
fi

. slowdefs

if [ ! -s $LOG ]
then
	sudo cp /dev/null $LOG
	user=`id -u -n`
	sudo chown $user $LOG
	chmod 644 $LOG
fi

mkdir -p $MOVIE_LIB/catalog	|| exit 3
